{
  "version": 3,
  "sources": ["../../../../node_modules/@formily/reactive-vue/node_modules/vue-demi/lib/index.mjs", "../../../../node_modules/@formily/reactive-vue/src/observer/collectData.ts", "../../../../node_modules/@formily/reactive-vue/src/observer/observerInVue2.ts", "../../../../node_modules/@formily/reactive-vue/src/hooks/useObserver.ts", "../../../../node_modules/@formily/reactive-vue/src/observer/observerInVue3.ts", "../../../../node_modules/@formily/reactive-vue/src/observer/index.ts"],
  "sourcesContent": ["import * as Vue from 'vue'\n\nvar isVue2 = false\nvar isVue3 = true\nvar Vue2 = undefined\n\nfunction install() {}\n\nexport function set(target, key, val) {\n  if (Array.isArray(target)) {\n    target.length = Math.max(target.length, key)\n    target.splice(key, 1, val)\n    return val\n  }\n  target[key] = val\n  return val\n}\n\nexport function del(target, key) {\n  if (Array.isArray(target)) {\n    target.splice(key, 1)\n    return\n  }\n  delete target[key]\n}\n\nexport * from 'vue'\nexport {\n  Vue,\n  Vue2,\n  isVue2,\n  isVue3,\n  install,\n}\n", "// https://github.com/mobxjs/mobx-vue/blob/master/src/collectData.ts\n\n/**\n * @author Kuitos\n * @homepage https://github.com/kuitos/\n * @since 2018-06-08 10:16\n */\n\nimport { isObservable } from '@formily/reactive'\n\nexport default function collectData(vm: any, data?: any) {\n  const dataDefinition =\n    typeof data === 'function' ? data.call(vm, vm) : data || {}\n  const filteredData = Object.keys(dataDefinition).reduce(\n    (result: any, field) => {\n      const value = dataDefinition[field]\n\n      if (isObservable(value)) {\n        Object.defineProperty(vm, field, {\n          configurable: true,\n          get() {\n            return value\n          },\n        })\n      } else {\n        result[field] = value\n      }\n\n      return result\n    },\n    {}\n  )\n\n  return filteredData\n}\n", "// https://github.com/mobxjs/mobx-vue/blob/master/src/observer.ts\n\n/**\n * @author Kuitos\n * @homepage https://github.com/kuitos/\n * @since 2018-05-22 16:39\n */\nimport { Tracker, batch } from '@formily/reactive'\nimport collectDataForVue from './collectData'\nimport { Vue2 as Vue } from 'vue-demi'\nimport { IObserverOptions } from '../types'\n\nconst noop = () => {}\nconst disposerSymbol = Symbol('disposerSymbol')\n\nfunction observer(Component: any, observerOptions?: IObserverOptions): any {\n  const name =\n    observerOptions?.name ||\n    (Component as any).name ||\n    (Component as any)._componentTag ||\n    (Component.constructor && Component.constructor.name) ||\n    '<component>'\n\n  const originalOptions =\n    typeof Component === 'object' ? Component : (Component as any).options\n  // To not mutate the original component options, we need to construct a new one\n  const dataDefinition = originalOptions.data\n  const options = {\n    name,\n    ...originalOptions,\n    data(vm: any) {\n      return collectDataForVue(vm || this, dataDefinition)\n    },\n    // overrider the cached constructor to avoid extending skip\n    // @see https://github.com/vuejs/vue/blob/6cc070063bd211229dff5108c99f7d11b6778550/src/core/global-api/extend.js#L24\n    _Ctor: {},\n  }\n\n  // we couldn't use the Component as super class when Component was a VueClass, that will invoke the lifecycle twice after we called Component.extend\n  const superProto =\n    typeof Component === 'function' &&\n    Object.getPrototypeOf(Component.prototype)\n  const Super =\n    superProto instanceof (Vue as any) ? superProto.constructor : Vue\n  const ExtendedComponent = Super.extend(options)\n\n  const { $mount, $destroy } = ExtendedComponent.prototype\n\n  ExtendedComponent.prototype.$mount = function (this: any, ...args: any[]) {\n    let mounted = false\n    this[disposerSymbol] = noop\n\n    let nativeRenderOfVue: any\n\n    const reactiveRender = () => {\n      batch(() => {\n        tracker.track(() => {\n          if (!mounted) {\n            $mount.apply(this, args)\n            mounted = true\n            nativeRenderOfVue = this._watcher.getter\n            // rewrite the native render method of vue with our reactive tracker render\n            // thus if component updated by vue watcher, we could re track and collect dependencies by @formily/reactive\n            this._watcher.getter = reactiveRender\n          } else {\n            nativeRenderOfVue.call(this, this)\n          }\n        })\n      })\n\n      return this\n    }\n\n    reactiveRender.$vm = this\n\n    const tracker = new Tracker(() => {\n      if (\n        reactiveRender.$vm._isBeingDestroyed ||\n        reactiveRender.$vm._isDestroyed\n      ) {\n        return tracker.dispose()\n      }\n\n      if (\n        observerOptions?.scheduler &&\n        typeof observerOptions.scheduler === 'function'\n      ) {\n        observerOptions.scheduler(reactiveRender)\n      } else {\n        reactiveRender()\n      }\n    })\n\n    this[disposerSymbol] = tracker.dispose\n\n    return reactiveRender()\n  }\n\n  ExtendedComponent.prototype.$destroy = function (this: any) {\n    ;(this as any)[disposerSymbol]()\n    $destroy.apply(this)\n  }\n\n  const extendedComponentNamePropertyDescriptor =\n    Object.getOwnPropertyDescriptor(ExtendedComponent, 'name') || {}\n  if (extendedComponentNamePropertyDescriptor.configurable === true) {\n    Object.defineProperty(ExtendedComponent, 'name', {\n      writable: false,\n      value: name,\n      enumerable: false,\n      configurable: false,\n    })\n  }\n\n  return ExtendedComponent\n}\n\nexport { observer, observer as Observer }\n", "import { Tracker } from '@formily/reactive'\nimport { getCurrentInstance, onBeforeUnmount, isVue3 } from 'vue-demi'\nimport { IObserverOptions } from '../types'\n\n/* istanbul ignore next */\nexport const useObserver = (options?: IObserverOptions) => {\n  if (isVue3) {\n    const vm = getCurrentInstance()\n    let tracker: Tracker = null\n    const disposeTracker = () => {\n      if (tracker) {\n        tracker.dispose()\n        tracker = null\n      }\n    }\n    const vmUpdate = () => {\n      vm?.proxy?.$forceUpdate()\n    }\n\n    onBeforeUnmount(disposeTracker)\n\n    Object.defineProperty(vm, 'effect', {\n      get() {\n        // https://github.com/alibaba/formily/issues/2655\n        return vm['_updateEffect'] || {}\n      },\n      set(newValue) {\n        vm['_updateEffectRun'] = newValue.run\n        disposeTracker()\n        const newTracker = () => {\n          tracker = new Tracker(() => {\n            if (options?.scheduler && typeof options.scheduler === 'function') {\n              options.scheduler(vmUpdate)\n            } else {\n              vmUpdate()\n            }\n          })\n        }\n\n        const update = function () {\n          let refn = null\n          tracker?.track(() => {\n            refn = vm['_updateEffectRun'].call(newValue)\n          })\n          return refn\n        }\n        newTracker()\n        newValue.run = update\n        vm['_updateEffect'] = newValue\n      },\n    })\n  }\n}\n", "import { IObserverOptions } from '../types'\nimport { useObserver } from '../hooks/useObserver'\n\n/* istanbul ignore next */\nexport const observer = function (opts: any, options?: IObserverOptions): any {\n  const name = options?.name || opts.name || 'ObservableComponent'\n\n  return {\n    name,\n    ...opts,\n    setup(props: Record<string, any>, context: any) {\n      useObserver(options)\n      return opts?.setup?.(props, context)\n    },\n  }\n}\n", "import { isVue2 } from 'vue-demi'\nimport { observer as observerV2 } from './observerInVue2'\nimport { observer as observerV3 } from './observerInVue3'\nimport collectData from './collectData'\nimport { IObserverOptions } from '../types'\n\nexport function observer<C>(baseComponent: C, options?: IObserverOptions): C {\n  /* istanbul ignore else */\n  if (isVue2) {\n    return observerV2(baseComponent, options)\n  } else {\n    return observerV3(baseComponent, options)\n  }\n}\n\nexport { collectData }\n"],
  "mappings": "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",
  "names": ["observer", "__assign", "observer"]
}
